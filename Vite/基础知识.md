# vite

1. åŸºäºŽ ES Moduleï¼ŒIE11ä»¥ä¸Šæµè§ˆå™¨

2. æŒ‰éœ€ç¼–è¯‘ï¼Œåœ¨é¡¹ç›®ä½¿ç”¨æ¨¡å—æ—¶æ‰è¯·æ±‚ç¼–è¯‘æ‰€éœ€æ¨¡å—

   ```typescript
   `æœ‰åˆ«äºŽwebpack`ï¼š
   
   `1.` webpackåœ¨é¡¹ç›®å¯åŠ¨æ—¶å·²ç»å¯¹æ‰€æœ‰çš„æ¨¡å—è¿›è¡Œæ‰“åŒ…ã€å› æ­¤æ¯”è¾ƒæ…¢ã€‘ï¼Œviteæ˜¯æŒ‰éœ€ç¼–è¯‘åŠ è½½ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶ä¸éœ€è¦åˆ†æžæ¨¡å—çš„ä¾èµ–ï¼Œä¸éœ€è¦ç¼–      è¯‘ï¼Œå› æ­¤`å¯åŠ¨éžå¸¸å¿«`ï¼Œç”±äºŽæ˜¯æŒ‰éœ€åŠ è½½ï¼Œå› æ­¤æžå¤§çš„ç¼©å‡äº†ç¼–è¯‘æ—¶é—´ï¼Œé¡¹ç›®è¶Šå¤æ‚ï¼Œæ¨¡å—è¶Šå¤šï¼Œviteä¼˜åŠ¿è¶Šæ˜Žæ˜¾
   `2.` HMR[çƒ­æ›´æ–°],å½“æ–‡ä»¶æ”¹å˜æ—¶ï¼Œä»…éœ€è¦è®©æµè§ˆå™¨é‡æ–°è¯·æ±‚è¯¥æ¨¡å—å³å¯ï¼Œæœ‰åˆ«äºŽwebpackéœ€è¦æŠŠè¯¥æ¨¡å—çš„ç›¸å…³æ¨¡å—å…¨éƒ¨ç¼–è¯‘ä¸€æ¬¡
   `3.`æ‰“åŒ…åˆ°ç”Ÿäº§çŽ¯å¢ƒæ—¶ï¼Œviteä½¿ç”¨Rollupï¼Œ
   
   `å› æ­¤ vite çš„ ä¼˜åŠ¿ä¸»è¦åœ¨å¼€å‘é˜¶æ®µ`
   
   ç¼ºç‚¹ï¼šç”±äºŽä¾èµ–äºŽ ES Moduleï¼Œå› æ­¤é¡¹ç›®ä¸­ ä¸å¯ä»¥ä½¿ç”¨ CommonJSã€‚
   
   `é—®é¢˜1ï¼š`
 æ¯æ¬¡è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å¦‚ä½•ç¡®å®š
     main.ts -> app-tab ->index.ts[å¼•å…¥a.component.ts]
                          a.component.ts[å¼•å…¥b.component.ts]
                          b.component.ts
     è¯·æ±‚åˆ°ä»£ç†æœåŠ¡å™¨åŽindex/a/bè·¯å¾„æŸ¥æ‰¾é—®é¢˜ã€‚å¦‚ä½•ç›´åˆ°æ˜¯ä»Žå“ªä¸ªæ–‡ä»¶æ‰¾ã€‚
    ã€vite.config.jsé…ç½® ä½¿ç”¨ç»å¯¹è·¯å¾„ alias '/@/':path.resolve(__dirname, './src')ã€‘
    
    
    `--Viteå¯¹æŒ‰éœ€ç¼–è¯‘çš„å¤„ç†----------------------------------------------`
    importçš„ æ–‡ä»¶ç»Ÿä¸€ä»¥'/@/'å¼€å¤´ï¼Œ'/@/'ä½œä¸ºæ ¹è·¯å¾„ã€‚ðŸ‘†
    å› æ­¤ è¯·æ±‚çš„æ–‡ä»¶å°±åˆ†ä¸ºï¼š'/@/'å¼€å¤´çš„æºä»£ç å¯¼å…¥
                       '/@modules/'å¼€å¤´çš„ä¾èµ–å¯¼å…¥
                       '.ico, .png, ...' å›¾ç‰‡
    css å’Œ html                    
   ```
   
   
   
3. ä¾èµ–é¢„ç¼–è¯‘

   ```typescript
   vite ä¼šåœ¨ DevServerå¯åŠ¨å‰å¯¹éœ€è¦é¢„ç¼–è¯‘çš„ä¾èµ–è¿›è¡Œç¼–è¯‘ï¼Œç„¶åŽåœ¨åˆ†æžæ¨¡å—å¯¼å…¥çš„æ—¶å€™ï¼Œåº”ç”¨ç¼–è¯‘è¿‡çš„ä¾èµ–ã€‚
   
   `é»˜è®¤æƒ…å†µ`ä¼šå°† package.jsonä¸­çš„  dependencies è¿›è¡Œé¢„ç¼–è¯‘ã€‚ç„¶åŽå°†ç¼–è¯‘åŽçš„ç»“æžœç¼“å­˜åœ¨ node_modules/.viteä¸‹
   
   `ä¼˜ç‚¹`ï¼šè§£å†³ä¾èµ–é“¾è¿‡é•¿ï¼Œè¯·æ±‚å¤šæ¬¡ï¼Œç”±äºŽæµè§ˆå™¨å¹¶è¡Œè¯·æ±‚æ•°é‡æœ‰é™åˆ¶ï¼Œè¿‡å¤šä¼šç­‰å¾…ï¼Œé€ æˆæµè§ˆå™¨é˜»å¡žçš„é—®é¢˜
          ä¾èµ–å¯èƒ½ä¸æ”¯æŒ ESModuleï¼Œéœ€è¦ç¼–è¯‘æˆæ”¯æŒESModule
          
          
   `dependenciesç¼–è¯‘ï¼Œé‡åˆ°é—®é¢˜-----------`
     zone.jsä¾èµ–çš„package.json æ—  module å±žæ€§ï¼Œåªæœ‰browseræŒ‡å‘ æ–‡ä»¶
   `é¢„è§£æžçš„ä¾èµ– æ¨¡å—é—´ç›¸äº’å¼•ç”¨`  coreï¼šApplicationModuleã€åœ¨Aã€‘
                             platform-browser-dynamicï¼šå¼•ç”¨ ApplicationModuleã€Aã€‘
                             platform-browserï¼šå¼•ç”¨ ApplicationModuleã€Aã€‘
    ä½†æ˜¯é¢„è§£æžä¾èµ– ä¼šå°† ApplicationModule  åœ¨ä¸‰ä¸ªæ–‡ä»¶éƒ½æœ‰                        
   ```

   

4. æ–‡ä»¶ç¼“å­˜

   ```typescript
   è®¾ç½®æµè§ˆå™¨ç¼“å­˜ã€‚
   
   ```


# Rollup

## æ’ä»¶

### @rollup/plugin-node-resolve

```
è§£æž æ–‡ä»¶çš„ å¯¼å…¥å±žæ€§ï¼Œå¹¶å°†å¯¼å…¥å±žæ€§æ‰“åŒ…ã€‚
```

# Angularé—®é¢˜

1. *@angular/platform-browser-dynamic*

   å¼•å…¥ @angular/platform-browser-dynamic æ—¶ï¼Œæ›¿æ¢å†…éƒ¨çš„ from â€œè¯­æ³•â€ => from "/@modules/"ï¼Œä¼šåŒ¹é…åˆ° ã€ EmitterVisitorContext.prototype.printlnã€‘å‡½æ•°ï¼Œ å…¶è§£æžå¤±è´¥ã€‚

   ```typescript
   EmitterVisitorContext.prototype.println = function (from, lastPart) {
       if (lastPart === void 0) { lastPart = ''; }
       this.print(from || null, lastPart, true);
   };
   `----------------------ðŸ‘‡---------------------------`
   EmitterVisitorContext.prototype.println = function (from, lastPart) {
           if (lastPart === void 0) { lastPart = ''; }
           this.print(from '/@modules/| null, lastPart, true);
   };
   `-----åŒ¹é…å‡½æ•°`ï¼š
   function rewriteImports(content) {
     return content.replace(/from\s*['|"]([^'"]+)['|"]/g, function ($0, $1) {
       if ($1.indexOf("/@/") !== 0) {
         console.log(`from '/@modules/${$1}'`);
         return `from '/@modules/${$1}'`;
       } else {
         return $0;
       }
     });
   }
   
   åŒ¹é…å‡½æ•°æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šåŒ¹é…åˆ°æ¡†æž¶å‡½æ•°ï¼Œå‡ºçŽ°è¿™ç§æƒ…å†µçš„åŽŸå› ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ
   
   ```

   

2. Zone éœ€è¦ ç‹¬ç«‹å¼•å…¥ã€‚

3. **.component.ts 

   ```typescript
   è§£æžç¼–è¯‘ç»„ä»¶æ—¶ï¼ŒæŒ‡ä»¤@Componentå°† å…ƒæ•°æ® æ·»åŠ åˆ° class.metadata,ä½†æœªè¿›è¡Œè½¬æ¢ã€‚
   Angular åœ¨è§£æžæ—¶ï¼ŒstyleUrls/templateUrl å·²è¢«ã€compiler-cliã€‘è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å› æ­¤ä¼šæŠ¥é”™
   ------------------------------------------
   Angularåœ¨ç¼–è¯‘å‰ æœ‰ updateDecoratorMetadataã€compiler-cliã€‘ è§£æž
   ```

   

4. inject() must be called from an injection context

   ```typescript
   æ¥æºï¼šplatform-browser.js
   æŠ¥é”™ä¿¡æ¯ï¼š`inject() must be called from an injection context`
   åŽŸå› ï¼šRollupæ‰“åŒ…æ—¶ï¼Œè§£æžimpotä¸€èµ·æ‰“åŒ…äº†ï¼Œå¯¼è‡´å¤šæ¨¡å—ä¾èµ–åŒä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸‰ä¸ªåŒ…ï¼Œæ¯ä¸ªåŒ…éƒ½ç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œä½¿_currentInjectorèµ‹å€¼æœªç”Ÿæ•ˆã€‚ã€‚ã€‚ã€‚
   
   ```

   

5. componentçš„ Éµcmpï¼ŒÉµfac

   ```typescript
   `Éµcmp`ï¼Œ`Éµfac` æ˜¯ @Component è£…é¥°å™¨ ç»™class æ·»åŠ çš„é™æ€å±žæ€§
   æ— æ¨¡å—å†™æ³•ï¼Œæ˜¯ç»™ component çš„ defå±žæ€§æ·»åŠ  directiveDefså’Œ pipeDefsã€‚
   å› æ­¤é¡ºåºåº”è¯¥æ˜¯ å…ˆæ‰§è¡Œ Componentå†æ‰§è¡Œ æ— æ¨¡å—èµ‹å€¼è£…é¥°å™¨ã€‚
   
   ```

   

6. æŒ‡ä»¤ï¼Œä¾èµ–æ³¨å…¥æŠ¥é”™

   ```typescript
   `æŠ¥é”™ä¿¡æ¯`ï¼šERROR Error: ASSERTION ERROR: token must be defined [Expected=> null != null <=Actual]
   `å®šä½`ï¼šã€return getOrCreateInjectable((/** @type {?} */ (tNode)), lView, resolveForwardRef(token), flags);ã€‘
   
   `ä¾‹å¦‚`ï¼šconstructor(@Optional() public tabs: TabbedPaneComponent) {}
    æ³¨å…¥ TabbedPaneComponentï¼Œåœ¨è§£æžæ—¶æœªæ”¶åˆ° å‚æ•°tabs[token]çš„å€¼(null)ï¼ŒæŠ¥é”™
    
   ` åŽŸå› `:åœ¨ç”Ÿæˆ æŒ‡ä»¤çš„ Éµfac å‡½æ•°æ—¶ï¼Œæœªæ‰¾åˆ° æ³¨å…¥çš„æœåŠ¡ï¼Œä¸ºnull
          æŒ‡ä»¤çš„ã€ctorParametersã€‘å±žæ€§ä¸ºundifinedã€é™æ€å‚æ•°å±žæ€§æœªæ·»åŠ ã€‘
          
         `ã€ctorParametersã€‘ æ˜¯ Angular-cli ä½¿ç”¨ts ç‰¹æ®Šå¤„ç†çš„ï¼Œesbuildè½¬æ¢.tsæ–‡ä»¶ä¼šä¸¢å¤±`
          
   `è§£å†³æ–¹æ³•`ï¼šä½¿ç”¨esbuild å¼¥è¡¥ Angular-cliçš„èƒ½åŠ›ï¼Œ
             â…  ç»™classæ·»åŠ é™æ€å±žæ€§ ctorParameters
   
   ```

   

7. ä½¿ç”¨ esbuild è½¬æ¢ .tsï¼Œ

   ```typescript
   
   â…  è½¬æ¢ å‚æ•°templateUrlï¼ŒstyleUrlsçš„è·¯å¾„ä¸ºå®žé™…å†…å®¹
   â…¡ ç»™classæ·»åŠ é™æ€å±žæ€§ ctorParameters
   ```

   

8. æ”¶åˆ°

