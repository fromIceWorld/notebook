# å¾®å‰ç«¯

## single-spa

### åŠ è½½å­åº”ç”¨

```typescript
`js Entry`:åŠ è½½å­åº”ç”¨çš„jsæ–‡ä»¶
```

## qiankun

### åŠ è½½å­åº”ç”¨

```typescript
`html Entry`:åŠ è½½å­åº”ç”¨çš„htmlæ–‡ä»¶
```

### dom,csséš”ç¦»

```typescript
`shadow dom`
1.åˆ›å»º:ç›´æ¥å†™å…¥cssæ ·å¼
2.æ›´æ–°ï¼šæ ¹æ®proxyä»£ç†ç¡®å®šmicçš„shadow domï¼Œç›´æ¥append
```

### jsç¯å¢ƒéš”ç¦»

```typescript
`setIntervalï¼ŒaddEventListenerï¼ŒhistoryListener,domæ“ä½œ....å…¨å±€å˜é‡ï¼ŒlocalStorage`
---------------------------------------------------------------
`å¤šåº”ç”¨å¹¶å­˜`ï¼šProxySandbox
`ä¸æ”¯æŒProxy`ï¼šSnapshotSandbox
---------------------------------------------------------------
`æ”¹å˜jsæ‰§è¡Œç¯å¢ƒ`ï¼šç»™jsè¡¨è¾¾å¼æ·»åŠ ä½œç”¨åŸŸé“¾ã€ä»£ç†ã€‘
with(ä»£ç†){
	     
}
---------------------------------------------------------------    
ã€ä»£ç†é€»è¾‘ã€‘ï¼š
	1.åŠ«æŒäº‹ä»¶ï¼Œåˆå§‹åŒ–jsæ—¶ï¼Œå»ºç«‹windowçš„Proxyä»£ç†ï¼Œåœ¨mountæ—¶ä½¿jsç»è¿‡ä»£ç†ï¼Œä»£ç†è®°å½•ä¸‹æ“ä½œï¼Œunmountæ—¶é”€æ¯ã€‚
ã€domæ“ä½œåŠ«æŒã€‘ï¼šå¯èƒ½ä¼šåŠ¨æ€ç”Ÿæˆ<script src="">,<link href="">,<style>;
	1.é‡å†™createElementï¼Œappendï¼ŒinsertBeforeAPI
```

**HTMLEntry**ã€æ–¹æ¡ˆ1ã€‘

```typescript
é…ç½®ç»™å®šå…¥å£ï¼Œfetchè¯·æ±‚èµ„æºï¼Œè§£æå‡ºjså’Œcssæ–‡ä»¶èµ„æºåï¼Œæ’å…¥åˆ°ç»™å®šçš„å®¹å™¨ä¸­;
```

**JS Entry**ã€æ–¹æ¡ˆ2ã€‘

```

```

**CustomElement + HTMLEntry**ã€‚

```typescript
<micro-app name="**" url="**">
    
`CustomElement:`è‡ªå®šä¹‰ç»„ä»¶
`HTMLEntry:`htmlæ–‡ä»¶ä½œä¸ºå…¥å£åœ°å€

```

## MicroApp

```
1.ä»¥ WebComponentsä¸ºåŸºç¡€ï¼Œåˆ›å»ºè‡ªå®šä¹‰æ ‡ç­¾ï¼Œæä¾›äº†å…ƒç´ çš„æ¸²æŸ“ï¼Œå¸è½½ï¼Œå±æ€§ä¿®æ”¹ç­‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°
```

## å…¶ä»–æ€è·¯

```typescript
ğŸ‘†`jséš”ç¦»ä¸å¤Ÿå¥½`ï¼š
1.jsè¿è¡Œåœ¨iframeä¸­
2.dom, cssæ”¾åœ¨web components
```

## å­åº”ç”¨æ–‡ä»¶ã€jsonã€‘

```typescript
`js entry`ï¼šè·å–æ‰€æœ‰éœ€è¦åŠ è½½çš„micçš„æ–‡ä»¶
---------------------------------------------------
    
`stats-webpack-plugin`:å°†æ„å»ºçš„ç»Ÿè®¡ä¿¡æ¯å†™å…¥æ–‡ä»¶;ã€webpack-manifest-pluginï¼Œasset-webpack-pluginç±»ä¼¼ã€‘

----------------------------------------------------
1.mainåº”ç”¨å¼•å…¥micæ—¶ï¼Œå¯è·å–å¯¹åº”jsonæ–‡ä»¶ã€ç›®å½•ã€‘ï¼ŒçŸ¥æ‚‰å­åº”ç”¨éœ€è¦åŠ è½½çš„æ–‡ä»¶ã€‚
```

## æ¸²æŸ“

```typescript
`1.` WebComponentåˆ›å»ºè‡ªå®šä¹‰å…ƒç´ 
     Â·åˆ›å»ºå…ƒç´ å®¹å™¨ <micro-app name="**" url="**">
     Â·è‡ªå¸¦ç”Ÿå‘½å‘¨æœŸã€åœ¨é’©å­ä¸­åŠ è½½/æ¸²æŸ“å­åº”ç”¨ã€‘

ç”Ÿå‘½å‘¨æœŸ:
`connectedCallback:`åŠ è½½å­åº”ç”¨
`disconnectedCallback:`å¸è½½å­åº”ç”¨
å…¥å‚æ£€æµ‹ï¼š
`attributeChangedCallback:`å½“nameï¼Œurlæ”¹å˜æ—¶ï¼Œæ ¹æ®urlè¯·æ±‚å­åº”ç”¨
```

## æ²™ç®±

```typescript
`è§£å†³å­åº”ç”¨jsè®¾ç½®å…³äºwindowçš„å˜é‡ï¼Œç›‘å¬äº‹ä»¶ï¼Œåœ¨åˆ›å»ºæ—¶å’Œå…¶ä»–åº”ç”¨æ··ä¹±ï¼Œé”€æ¯å­åº”ç”¨æ—¶ï¼Œäº‹ä»¶æœªè¢«é”€æ¯`

`1.` åœ¨å­åº”ç”¨åˆå§‹åŒ–æ—¶åˆ›å»ºæ²™ç®±ã€æ²™ç®±å†…è®¾ç½®ä»£ç†å¯¹è±¡Proxyã€‘
`2.` å­åº”ç”¨çš„jsé€šè¿‡withå¤„ç†ï¼Œä¿®æ”¹jsä½œç”¨åŸŸï¼Œå°†å­åº”ç”¨çš„windowæŒ‡å‘ä»£ç†å¯¹è±¡

`3.` æ²™ç®±ä¸­é‡å†™window.addEventListener å’Œwindow.removeEventListener
     è®°å½•å…¨å±€ç›‘å¬äº‹ä»¶ï¼Œåœ¨åº”ç”¨å¸è½½æ—¶æ¸…ç©º
```

## æ ·å¼éš”ç¦»

#### 1.ç»™classåŠ å…¥å±æ€§é™åˆ¶

```typescript
`1.` <link rel="stylesheet" type="text/css" href="link.css" />
    link å¼•å…¥çš„è¿œç¨‹cssè½¬æ¢ä¸ºstyleæ ‡ç­¾ã€å°†linkå…ƒç´ è½¬æ¢ä¸ºstyleã€‘
    
`2.` æ’å…¥styleæ ‡ç­¾    
     å¯¹åŠ è½½çš„å­åº”ç”¨æ ·å¼ä¿®æ”¹ .test{}  => micro-app[name=**] .test{}
     
`3.`åŠ¨æ€æ·»åŠ çš„styleå…ƒç´ 
    Â·MutationObserverã€observe()ã€‘ç›‘å¬æŒ‡å®šçš„dom //ç›‘å¬styleå…ƒç´ 
    
    
`CSSRulesï¼š`å½“æœ‰styleæ ‡ç­¾è¢«æ’å…¥åˆ°æ–‡æ¡£æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸ºstyleå…ƒç´ åˆ›å»ºCSSStyleSheetæ ·å¼è¡¨ï¼Œ
            ä¸€ä¸ª CSS æ ·å¼è¡¨åŒ…å«äº†ä¸€ç»„è¡¨ç¤ºè§„åˆ™çš„ CSSRule å¯¹è±¡ã€‚
            æ¯æ¡ CSS è§„åˆ™å¯ä»¥é€šè¿‡ä¸ä¹‹ç›¸å…³è”çš„å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™äº›è§„åˆ™è¢«åŒ…å«åœ¨ CSSRuleList å†…ï¼Œ
            å¯ä»¥é€šè¿‡æ ·å¼è¡¨çš„ cssRules å±æ€§è·å–ã€‚
            
`document.styleSheets[0].cssRules`            
            
æ‰€ä»¥cssRuleså°±æ˜¯ç”±å•ä¸ªCSSè§„åˆ™ç»„æˆçš„åˆ—è¡¨ï¼Œæˆ‘ä»¬åªéœ€è¦éå†è§„åˆ™åˆ—è¡¨ï¼Œå¹¶åœ¨æ¯ä¸ªè§„åˆ™çš„é€‰æ‹©å™¨å‰åŠ ä¸Šå±æ€§ä¿®é¥°ç¬¦micro-app[name=xxx]ï¼Œå°±å¯ä»¥å°†å½“å‰styleæ ·å¼çš„å½±å“é™åˆ¶åœ¨micro-appå…ƒç´ å†…éƒ¨ã€‚  
`ç¼ºç‚¹`ï¼šéœ€è¦ç»™mic-appä¸­çš„æ‰€æœ‰domä¸Šéƒ½æ·»åŠ å±æ€§
```

![cssRules](C:\Users\å´”å†°å†°\Desktop\sea\å¾®å‰ç«¯\cssRules.jpg)

#### 2.shadow dom

#### 3.css Modules

```typescript
1.å°†cssçš„classåç§°ç¼–è¯‘æˆå”¯ä¸€å­—ç¬¦;ã€webpack é…ç½®ã€‘
	{test:/\.css$/,loader:'style-loader!css-loader?modules'}
2.
```



### cssRules

```typescript
`è·å–cssRulesæ—¶å‡ºç°çš„é—®é¢˜ï¼š`å½“æˆ‘ä»¬çš„æ ·å¼æœ‰<link>å¯¼å…¥çš„æ ·å¼æ—¶ï¼Œdocument.styleSheets[0].cssRules
æ˜¯æ— æ³•è·å–æ ·å¼çš„ã€CORS å®‰å…¨è§„åˆ™ã€‘

ä¸è¿‡æˆ‘ä»¬åœ¨æ¸²æŸ“é˜¶æ®µå·²ç»å°†linkè½¬æ¢æˆstyle
```



## æ•°æ®é€šä¿¡

```typescript
å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼šåŸºåº§åº”ç”¨å‘å­åº”ç”¨å‘é€æ•°æ®;
           å­åº”ç”¨å‘åŸºåº§åº”ç”¨å‘é€æ•°æ®
           å­åº”ç”¨é—´çš„æ•°æ®é€šä¿¡é€šè¿‡åŸºåº§åº”ç”¨æ§åˆ¶
`1.` åŸºåº§åº”ç”¨åˆå§‹åŒ–æ—¶åˆ›å»ºä¸­å¿ƒé€šè®¯å¯¹è±¡
`2.` å­åº”ç”¨åˆå§‹åŒ–æ—¶åˆ›å»ºè‡ªèº«é€šä¿¡å¯¹è±¡
`3.` é‡å†™ElementåŸå‹é“¾ä¸Šçš„setAttributeæ–¹æ³•ï¼Œå½“micro-appè®¾ç½®dataæ—¶è¿›è¡Œç‰¹æ®Šå¤„ç†ã€webComponentä¸æ”¯æŒä¼ é€’å¯¹è±¡ã€‘
```

#### CustomEvent

```typescript
æµè§ˆå™¨æ”¯æŒçš„eventäº‹ä»¶ï¼š
ev.addEventListener("eventName",(e)=>{
	
})
let event = new CustomEvent("eventName",{
    detail,
	bubbles,
    cancelable,
})
ev.dispatchEvent(event);
`ev`:å¯ä»¥æ˜¯domå…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯window
```

# iframe

```typescript
`ç¼ºç‚¹`ï¼š
1.iframeçŠ¶æ€ï¼Œæ— æ³•åœ¨æ•´ä½“è·¯ç”±ä¸Šç¼“å­˜ã€å³ä½¿ç›¸åŒçš„æ¡†æ¶ï¼Œä¹Ÿæ— æ³•é€šè¿‡iframe cache è·¯ç”±ã€‘
2.iframeå¼¹çª—
```

